{% extends "base.html" %}
{% block title %}Impact Simulator — Arabyo{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h2>Regulatory Impact Simulator</h2>
        <div class="subtitle">Retroactive analysis: how would new or changed rules affect historical transactions?</div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Run simulation</h3>
    </div>
    <div class="card-body">
        <form id="simulationForm" class="form-stacked">
            <div class="form-group">
                <label for="ruleset_id">Proposed rule set</label>
                <select name="ruleset_id" id="ruleset_id" required>
                    <option value="">— Select rule set —</option>
                    {% for rs in rulesets %}
                    <option value="{{ rs.id }}">{{ rs.id }} ({{ rs.ruleset_version }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="start_date">Start date</label>
                    <input type="date" name="start_date" id="start_date" required>
                </div>
                <div class="form-group">
                    <label for="end_date">End date</label>
                    <input type="date" name="end_date" id="end_date" required>
                </div>
            </div>
            <div class="form-group">
                <label><input type="checkbox" name="include_ml" id="include_ml"> Include ML signals</label>
            </div>
            <div class="form-group">
                <label><input type="checkbox" name="include_graph" id="include_graph"> Include graph signals</label>
            </div>
            <button type="submit" class="btn btn-primary" id="runBtn">Run simulation</button>
        </form>
        <div id="simProgress" style="display:none; margin-top: 16px;">
            <div class="loading-spinner" style="margin-right: 8px;"></div>
            <span>Running simulation on historical data…</span>
        </div>
        <div id="simError" class="auth-message error" style="display:none;"></div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Recent runs</h3>
    </div>
    <div class="card-body">
        <div id="historyList">Loading…</div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/simulation.js') }}"></script>
{% endblock %}
